#include "log_analysis/common/log_common.h"
#include "base/common/basic_types.h"
#include "base/testing/gtest.h"
#include "base/time/time.h"
#include "base/strings/string_split.h"
#include "base/file/file_util.h"
#include "base/hash_function/md5.h"
#include "nlp/common/nlp_util.h"
#include "base/encoding/line_escape.h"

namespace log_analysis {

TEST(ParseBaiduTargetUrl, cases) {
  struct UrlQuery {
    const char* url;
    const char* target_url;
    bool ret;
  } cases[] = {
    {"http://www.baidu.com/link?url=b68b8849e523231b472fe233fb98e69b9aa2ff892641b3ff64c09a93c595000c264caaf67781a99f70fe1d9c69fbc3007ca70c4bf12589bb9913f2f005444c149a292186c2f3e7bee21969ff9efade1f65580f5f35d09a76b5761d03e8e38b73cc4a1d6f054dce9be21bd7f0c950678775f624bfdaea9e36532a51ea1fa315e5e27ae2412ad11b36bb1bb7a077b09eeabccee157aa5d3aa7e26a7e4d3a6fe42bb7518c359fc01b3b4ccc5ff49ee3a7df24e7465782fc674f9ee340f810e67ded899e2d4c27d75db115b0d120498c257978460fb7edffa1a79941fc7c791f8feabc9b79bf768182002b4683b842c12b9c1edfd7cd6e76ffd5723603dfca14b39389477a8bf2d29eabe135870df430d8702be49c0afee8b2940cf66be629562c73a9b97dc6881a9993c61b45d2a2e45f1690229e83fdbda8e68c0882e913b1176a6e6029020a736e42fe3d1a2f595f1ac41e0c861c31e093dbe82a9f3f9869ebac5573358cc3c0659257bfcf546427d385e7f37035b5054d6843da279f6a", "http://www.imeigu.com/DD", true},  // NOLINT
    {"http://www.baidu.com/link?url=fc84924cba617f4c4b6bf965e09fa7839af1dbdc3518b3af29cd9a91e39e4528367ea8b277d28e9571ea1dbf68f8c84d59f05458f27b9ba9b012b2ed0f1b0d459c276fcb8ee7ebc9f3337ff6caa6c0106155174768de9923ba6b1452a4b58238c3415c20555b8294d610dde5da427ee32fa034fed5e09f7d141d519d0ee747eef373e95976d7432da50eb2932c8e8fffb6c5ab54a35e7ba5fc237f417c72b234e44a942ddef641690ddc14a8c6fca4863fbf504f90e561129cac40fc01ed68b5819f730822ca42bb08f0c05251c0282f324116b4faff8284d140df39321b93fbe1863fe778cfd34564418aeb1bf320811dd496c67266e1d7723f4ad9cc25a68090474ab0a8c190ebe52cc01ab227c16a66929015c0b0faa900ae7aec3254186cb3b633d9c5539e908b494cdfb9e61d0d9a3a99dafdbdbcb8885595ab4bb1377a2855241f47606d56bf3f1e1c575719984a0097587cf7d494a175b210882debac5573358cc3c0659257bfcf546427d385f7fb6637ab5e006441985bb4482706fe62a03ee164ccf05eed52ec4838ffa0438d8d2fa3d5405c38611a0108ffd58a689b8be437c8e03ecea4915cdf8871", "http://www.yesky.com/SoftChannel/72348973209223168/20040812/1841862.shtml", true},  // NOLINT
    {"http://www.hao123.com", "http://www.hao123.com", true},
    {"http://www.baidu.com/link?url=84924cba617f4c4b6bf965e09fa7839af1dbdc3518b3af29cd9a91e39e4528367ea8b277d28e9571ea1dbf68f8c84d59f05458f27b9ba9b012b2ed0f1b0d459c276fcb8ee7ebc9f3337ff6caa6c0106155174768de9923ba6b1452a4b58238c3415c20555b8294d610dde5da427ee32fa034fed5e09f7d141d519d0ee747eef373e95976d7432da50eb2932c8e8fffb6c5ab54a35e7ba5fc237f417c72b234e44a942ddef641690ddc14a8c6fca4863fbf504f90e561129cac40fc01ed68b5819f730822ca42bb08f0c05251c0282f324116b4faff8284d140df39321b93fbe1863fe778cfd34564418aeb1bf320811dd496c67266e1d7723f4ad9cc25a68090474ab0a8c190ebe52cc01ab227c16a66929015c0b0faa900ae7aec3254186cb3b633d9c5539e908b494cdfb9e61d0d9a3a99dafdbdbcb8885595ab4bb1377a2855241f47606d56bf3f1e1c575719984a0097587cf7d494a175b210882debac5573358cc3c0659257bfcf546427d385f7fb6637ab5e006441985bb4482706fe62a03ee164ccf05eed52ec4838ffa0438d8d2fa3d5405c38611a0108ffd58a689b8be437c8e03ecea4915cdf8871", "", false},  // NOLINT
    {"http://www.baidu.com/link?url=a184964ce362254b5c2fe32abe94a884a6e8c0962218c9e338d199d3aad45625220ea4ed60ccaa9c29a958cf7ce5c1484cbb5b41ea7385f7b75feace0a1b506ac0615a959eaef6d0a5697cecdd", "http://www.kuaidi100.com/network/netList_10_210500.htm", true},  // NOLINT
//    {"http://www.baidu.com/link?url=a1d29048ed2f2f5e5c78f039e389e99da6e8c0962218c9e338d199d3aad4553b3042aeb663c4a7916db70b8e72a5ca5849a912f176cc160e6e1facb2dc849610b0", "http://tieba.baidu.com/f?kw=%c7%f3%cd%f8%d6%b7%20%bf%ec%b2%A", true},  // NOLINT
    {"http://www.baidu.com/link?url=92cf9b04fd247c4e5220be23bd99b794a6e8c0962218c9e338d199d3aad45625220eadf17bd1ab9974fc1acf7ce4831350bf4b53aa6281aaa968fbf20c1a501a923e77d7e6f0a58fba0151adf2bb854c547a54687092af6bea24086e85f0e25a9618753c430c9df1bf598da09c632f9419e4069accb1be12444211f55ebe77c3b826857514850461f74bffe214ddc8ad87e2f5168a19228ac83d5f012821d76ea115bc6ccfab587c51994a9e84a993ed6bfc6909d5b67a7ccf8037962bd046d9c9f26d510f8869d351a1e64c06af6b602f0922f1b1e0efcfc36de7162a07baccddd423a84bdeea2342158fe45ff3", "http://www.bizteller.cn/trade/corpReport/corpInfo/FE5B769ED0D05C9584AA2CF35D0537D71573A17E6AE52EC966A74AA91FDF1396791B311AA82F41BD2E918A775E78501719D48CA91D0107D5B7FCDCE1E04C8FF22E24E7745A585361CEB60CFE726E2BEC.html", true},  // NOLINT
    {"http://www.baidu.com/link?url=a2d78843fa307d471164ff31ee92e9ddcfe78d982118b6f22ccc93a9e0905a733858bbec25cdbcdc68f510bf70eec10f59b34556f57080b7aa59fef44f0f5e6b8c7521f9c2e4edbee36430e9d9fc990d6857014037c49e7bf67a4c71b5afe178cb5c5f52185482d9a10fc0e4c04240d11cbb21a891add8720817519a18ee41fffb7aa34239cc4234b01fabbb3882ddbdeed6bf40b95a6ea6e57b614e3579b719b75d8a269ce7182a26c713aff0cfa4cb71a0041595ae6c5399bb6b9005d465b897c6390939f06fe71abb8b08479d2d37616206afffbff6819a4edb316c448bd4e5a371e47e9edb176a15cbf647e97ed257da87d66c38ff9108674180d95fb9becb6308acf4f482effc28c00cac39c26b29c18046fef2fba11bfe62b827421a6cb9b069d8815a9a96c24e56dbbae11d3d882f92d2f7b5a5ea9e159deb49f12a6e776e6c124e7f725ff6290b7d43494ecb1112960f7be4c881fa25dc219a57ebac5573358cc3c0659257bfcf546938cdcfeff13b3eb319077e02d467b6012230f370ba39eb66ccf65eeb5ee04939feaa5ddccb70fc", "http://zhidao.baidu.com/question/125848628.html", true},  // NOLINT
    {"http://www.baidu.com/link?url=fbce9f46ec20241b726bf517f181a79495e3c292650eaeee65c99e84fca54c7c3d08b4bb69c1a2887efa4b8d35a4da4f03af035cf67889a3a450fdf80e495e5c9d727ecec7f7bb87ec3071b4d9a8f302775902476983ac7bae675a45a1bac57cdd5e5e22071cd29fe815deefdb4740c62eb424a888e09b285e1b4ece45a651aefb57e01d2bc95e71af06a0a63596d8b4ad8bad40a60132a5e3615a4c7a3db72bc801d02e83e71e2414d30bfec6fea7c52bb6034ccec63a5380e36bf31df97fb5b89b2c100cdc4af80de58a0d529f707d684e03bdfaf9b7b98148c47a7977dda9f7ca7dea7688cd1c2b508ff851ec21db1d8693c93b39e7932b64039bc513b89384714abd849dc6dbbb21870bbe339e6b68c39b12f7e7ebb703c47ae13650422ca9b539838e51de97825140d1a9ef170b982e9efefab4a1bf900e90e401f53f642171600a4160744df92a462544780796430c891a71e7df87e3379525936aebac5573358cc3c0659257bfcf546427d385fdf16629bd5e0d6a41d227", "http://www.sosuo.name/", true}, // NOLINT
  };

  for (size_t i = 0; i < ARRAYSIZE_UNSAFE(cases); i++) {
    std::string src;
    bool ret = ParseBaiduTargetUrl(cases[i].url, &src);
    EXPECT_EQ(ret, cases[i].ret);
    if (cases[i].ret) {
      EXPECT_STREQ(src.c_str(), cases[i].target_url);
    }
  }
}
}
